{% extends "base.html" %}

{% load tags %}
{% load i18n %}
{% load mptt_tags %}
{% load staticfiles %}

{% block title %}{{ block.super }} – {% trans "Agenda" %}{% endblock %}

{% block header %}
    <link type="text/css" rel="stylesheet" media="all" href="{% static 'styles/tabledrag.css' %}" />
    <link type="text/css" rel="stylesheet" media="all" href="{% static 'styles/agenda.css' %}" />
{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="{% static 'javascript/agenda.js' %}"></script>
    <script type="text/javascript" src="{% static 'javascript/jquery.cookie.js' %}"></script>
    {% if perms.agenda.can_manage_agenda %}
        <script type="text/javascript" src="{% static 'javascript/jquery.once.js' %}"></script>
        <script type="text/javascript" src="{% static 'javascript/jquery.tmpl.js' %}"></script>
        <script type="text/javascript" src="{% static 'javascript/tabledrag.js' %}"></script>
        <script type="text/javascript">
        <!--//--><![CDATA[//><!--
        //This is Drupal Code
        jQuery.extend(
          Drupal.settings,
        {
        "tableDrag":
          { "menu-overview":
            { "menu-plid":
              [ { "target": "menu-plid", "source": "menu-mlid", "relationship": "parent", "action": "match", "hidden": true, "limit": 8 } ],
              "menu-weight":
              [ { "target": "menu-weight", "source": "menu-weight", "relationship": "sibling", "action": "order", "hidden": true, "limit": 0 } ]
            }
          }
        });
        //--><!]]>
        </script>
    {% endif %}
{% endblock %}

{% block content %}
   <form action="" method="post">{% csrf_token %}
       {% if perms.agenda.can_manage_agenda %}
       <div id="changed-order-message" style="display:none" class="alert alert-warning">
           <button type="button" class="close" data-dismiss="alert">×</button>
           <p>{% trans "Do you want to save the changed order of agenda items?" %}</p>
           <p>
               <button class="btn" type="submit">{% trans 'Yes' %}</button>
               <a href="{% url 'item_overview' %}" class="btn">{% trans 'No' %}</a>
            </p>
       </div>
       {% endif %}

        <h1>{% trans "Agenda" %}
            <small class="pull-right">
            {% if perms.agenda.can_manage_agenda %}
            <a href="{% url 'item_new' %}" class="btn btn-mini" rel="tooltip" data-original-title="{% trans 'New item' %}"><i class="icon-plus"></i> {% trans "New" %}</a>
            {% endif %}
            <a href="{% url 'print_agenda' %}" class="btn btn-mini" rel="tooltip" data-original-title="{% trans 'Print agenda as PDF' %}"><i class="icon-print"></i> PDF</a>
            </small>
        </h1>
        
        {% if perms.agenda.can_see_orga_items %}
        {% if start and end %}
        <table id="agendatime" class="table table-bordered">
           <tr>
               <td>{% trans "Start of event" %}:</td>
               <td>{{ start|date:"DATETIME_FORMAT" }}</td>
           </tr>
           <tr>
               <td>{% trans "Estimated end" %}:</td>
               <td>{{ end|date:"DATETIME_FORMAT" }}</td>
           </tr>
        </table>
        {% endif %}
        {% endif %}
        <label class="checkbox">
            <input type="checkbox" id="hide_closed_items"> {% trans "Hide closed items" %}
        </label>

        <small><i>{{ items|length }}
        {% blocktrans count counter=items|length %}item{% plural %}items{% endblocktrans %}<span id="hiddencount"></span>
        </i></small>
        <table id="menu-overview" class="table table-striped table-bordered">
            <tr>
                <th class="mini_width"></th>
                <th>{% trans "Item" %}</th>
                {% if perms.agenda.can_manage_agenda %}
                    <th width="200" class="optional">{% trans "Comment" %}</th>
                {% endif %}
                {% if perms.agenda.can_see_orga_items %}
                    <th width="50">{% trans "Duration" %}</th>
                {% endif %}
                {% if perms.agenda.can_manage_agenda or perms.projector.can_manage_projector %}
                    <th class="mini_width">{% trans "Actions" %}</th>
                {% endif %}
                <th class="tabledrag-hide" style="display: none;">
                    {% trans "Weight" %}
                </th>
            </tr>
            <tr class="topline{% if active_sid == 'agenda' %} activeline{% endif %}">
                <td></td>
                <td>
                    {% trans "Agenda" %}
                </td>
                {% if perms.agenda.can_manage_agenda %}
                <td class="optional"></td>
                {% endif %}
                {% if perms.agenda.can_see_orga_items %}
                <td>{{duration}}h</td>
                {% endif %}
                {% if perms.agenda.can_manage_agenda or perms.projector.can_manage_projector %}
                <td>
                {% if perms.projector.can_manage_projector %}
                    <span>
                    <a href="{% url 'projector_activate_slide' 'agenda' %}" class="activate_link btn {% if active_sid == 'agenda' %}btn-primary{% endif %} btn-mini" title="{% trans 'Show' %}">
                        <i class="icon-facetime-video {% if active_sid == 'agenda' %}icon-white{% endif %}"></i>
                    </a>
                    <span>
                {% endif %}
                </td>
                {% endif %}
            </tr>
        {% if items %}
            {% for item in items %}
            <tr class="draggable{% if item.active %} activeline{% endif %}{% if item.closed %} offline{% endif %}">
                {% include "agenda/item_row.html" %}
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="5"><i>{% trans "No items available." %}</i></td>
            </tr>
        {% endif %}
        </table>
    </form>
{% endblock %}
