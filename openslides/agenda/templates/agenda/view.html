{% extends "base.html" %}

{% load i18n %}
{% load tags %}
{% load staticfiles %}

{% block title %}{{ block.super }} – {{ item.title }}{% endblock %}

{% block header %}
    <link type="text/css" rel="stylesheet" media="all" href="{% static 'styles/agenda.css' %}" />
    {% comment %} TODO: include stylesheet in our repo{% endcomment %}
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
{% endblock %}

{% block javascript %}
    {{ block.super }}
    {% comment %} TODO: import the sortable-plugin in our custom jquery-file {% endcomment %}
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="{% static 'javascript/agenda.js' %}"></script>
{% endblock %}

{% block content %}
<h1>
    {{ item }}
    <small class="pull-right">
    <div class="btn-toolbar">
        <a href="{% url 'item_overview' %}" class="btn btn-mini"><i class="icon-chevron-left"></i> {% trans "Back to overview" %}</a>
        {% if perms.agenda.can_manage_agenda %}
        <div class="btn-group">
            <a data-toggle="dropdown" href="#" class="btn btn-mini dropdown-toggle">
                {% trans 'More actions' %}
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu pull-right">
                <li><a href="{% url 'item_edit' item.id %}"><i class="icon-edit"></i> {% trans 'Edit item' %}</a></li>
                <li><a href="{% url 'item_delete' item.id %}"><i class="icon-remove"></i> {% trans 'Delete item' %}</a></li>
            </ul>
        {% endif %}
        </div>
        {% if perms.projector.can_manage_projector %}
            <a href="{% url 'projector_activate_slide' item.sid  %}"
                class="activate_link btn btn-mini {% if item.active and not show_list %}btn-primary{% endif %}"
                rel="tooltip" data-original-title="{% trans 'Show' %}">
                <i class="icon icon-facetime-video {% if item.active and not show_list %}icon-white{% endif %}"></i>
            </a>
        {% endif %}
    </div>
    </small>
</h1>
<p>{{ item.text|safe|linebreaks }}</p>

{% if perms.agenda.can_manage_agenda %}
    {% if item.comment %}
        <h3>{% trans "Comment" %}</h3>
        <p>{{ item.comment|linebreaks }}</p>
    {% endif %}
{% endif %}

{# List of Speakers #}
<h3>{% trans "List of speakers" %} {% if item.speaker_list_closed %}<span class="label label-important">{% trans 'closed' %}</span>{% endif %}</h3>
<p>
{% if perms.agenda.can_manage_agenda %}
    {% if item.speaker_list_closed %}
        <a href="{% url 'agenda_speaker_reopen' item.pk %}" class="btn btn-mini btn-danger">{% trans 'Open list' %}</a>
    {% else %}
        <a href="{% url 'agenda_speaker_close' item.pk %}" class="btn btn-mini btn-danger">{% trans 'Close list' %}</a>
    {% endif %}
{% endif %}
{% if perms.projector.can_manage_projector %}
    <a href="{% url 'projector_activate_slide' item.sid 'show_list_of_speakers' %}"
        class="activate_link btn btn-mini {% if item.active and show_list %}btn-primary{% endif %}"
        rel="tooltip" data-original-title="{% trans 'Show list of speakers' %}">
        <i class="icon icon-facetime-video {% if item.active and show_list %}icon-white{% endif %}"></i>
        {% trans 'Show list' %}
    </a>

{% endif %}
</p>

{% if old_speakers %}
<div class="well">
    <b>{% trans "Last speakers:" %}</b>
    <div class="btn-group" data-toggle="buttons-checkbox">
        <button type="button" class="btn btn-mini" data-toggle="collapse" data-target="#all_speakers">
            {% trans "Show all speakers" %}
        </button>
    </div>
    <br>
    <div id="all_speakers" class="collapse out">
        {% for speaker in old_speakers %}
            {% if not forloop.last %}
                <small>{{forloop.counter}}.
                    [{{ speaker.time }}h]
                    <a href="{% model_url speaker %}">{{ speaker }}</a>
                    {% if perms.agenda.can_manage_agenda %}
                        <a href="{% model_url speaker 'delete' %}" title="{% trans 'Delete' %}" class="btn btn-mini">
                            <i class="icon-remove"></i>
                        </a>
                    {% endif %}
                </small><br>
            {% endif %}
        {% endfor %}
    </div>
    {% if old_speakers %}
        {% with last=old_speakers|last %}
        <small>{{ old_speakers|length }}.
            [{{ last.time }}h]
            <a href="{% model_url last %}">{{ last }}</a>
            {% if perms.agenda.can_manage_agenda %}
                <a href="{% model_url last 'delete' %}" title="{% trans 'Delete' %}" class="btn btn-mini">
                    <i class="icon-remove"></i>
                </a>
            {% endif %}
        </small>
        {% endwith %}
    {% endif %}
</div>
{% endif %}

{% if perms.agenda.can_manage_agenda %}
    <form id="speaker_list_changed_form" action="{% url 'agenda_speaker_change_order' item.pk %}" method="post" style="display:none" class="alert alert-warning">{% csrf_token %}
        <button type="button" class="close" data-dismiss="alert">×</button>
        <p>{% trans "Do you want to save the changed order of speakers?" %}</p>
        <input id="sort_order" name="sort_order" type="hidden"></hidden>
        <p>
            <button class="btn" type="submit">{% trans 'Yes' %}</button>
            <a href="{% url 'item_view' item.pk %}" class="btn">{% trans 'No' %}</a>
        </p>
    </form>
{% endif %}


<div class="well">
    <b>{% trans "Next speakers:" %}</b>
    <ul {% if perms.agenda.can_manage_agenda %}id="list_of_speakers"{% endif %}>
        {% for speaker in speakers %}
            <li id="speaker_{{ speaker.pk }}">
                <span {% if perms.agenda.can_manage_agenda %}class="ui-icon ui-icon-arrowthick-2-n-s"{% endif %}></span>
                <span>{{ forloop.counter }}.</span>
                <a href="{% model_url speaker %}">{{ speaker }}</a>
                {% if perms.agenda.can_manage_agenda %}
                    <a href="{% url 'agenda_speaker_speak' item.pk speaker.person.person_id %}" class="btn btn-mini"><i class="icon-bell"></i> Finished speech</a>
                    <a href="{% model_url speaker 'delete' %}" title="{% trans 'Delete' %}" class="btn btn-mini">
                        <i class="icon-remove"></i>
                    </a>
                {% endif %}
            </li>
        {% empty %}
            <i>{% trans "The list of speakers is empty." %}</i>
        {% endfor %}
    </ul>

    <p>
        {% if is_speaker %}
            <a href="{% url 'agenda_speaker_delete' object.id %}" class="btn">{% trans "Remove me from the list" %}</a>
        {% elif not object.speaker_list_closed and perms.can_be_speaker %}
            <a href="{% url 'agenda_speaker_append' object.id %}" class="btn">{% trans "Put me on the list" %}</a>
        {% endif %}
    </p>

    {% if perms.can_manage_agenda %}
        <form action="" method="post">{% csrf_token %}
            {% for field in form %}
                <label>{{ field.label }}:</label>
                <div class="control-group input-append {% if field.errors %}error{% endif %}">
                    {{ field }}
                    <button class="btn btn-primary" type="submit" title="{% trans 'Apply' %}"><i class="icon-ok icon-white"></i></button>
                {% if perms.participant.can_see_participant and perms.participant.can_manage_participant %}
                    <a href="{% url 'user_new' %}" class="btn"  title="{% trans 'Add new participant' %}"><i class="icon-add-user"></i></a>
                {% endif %}
                {% if field.errors %}
                    <span class="help-inline">{{ field.errors }}</span>
                {% endif %}
                </div>
            {% endfor %}
        </form>
    {% endif %}

</div>
{% endblock %}
