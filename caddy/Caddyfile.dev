{
    # Enable debug output
    debug
}

localhost:8000

@autoupdate {
    path /system/*
    expression `{http.request.proto} == "HTTP/2.0"`
}
reverse_proxy @autoupdate autoupdate:8002 {
    flush_interval -1
}

@autoupdate_http1 {
    path /system/*
    expression {http.request.proto}.startsWith("HTTP/1")
}
respond @autoupdate_http1 "HTTP1 not supported" 400 {
    close
}


@server {
    path /apps/*
    path /rest/*
    path /server-version.txt
    path /media/*
}

reverse_proxy @server server:8000

reverse_proxy client:4200
